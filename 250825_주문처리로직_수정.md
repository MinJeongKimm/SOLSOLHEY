# 250825_μ£Όλ¬Έμ²λ¦¬λ΅μ§_μμ •

## π“‹ μ‘μ—… κ°μ”

**μ‘μ—… μΌμ**: 2025-08-25  
**μ‘μ—… λ‚΄μ©**: ShopServiceImplμ μ£Όλ¬Έμ²λ¦¬ λ΅μ§ μμ •  
**λ¬Έμ μ **: μ•„μ΄ν… κµ¬λ§¤ μ‹ "μ°Έμ΅° νƒ€μ…μ΄ μμ„ λ•λ” μ°Έμ΅° IDκ°€ ν•„μ”ν•©λ‹λ‹¤" μ—λ¬ λ°μƒ

## π” λ¬Έμ  λ¶„μ„

### **μ—λ¬ μƒν™©**
```
POST http://localhost:8080/api/v1/shop/orders 400 (Bad Request)
μ—λ¬ λ©”μ‹μ§€: "μ°Έμ΅° νƒ€μ…μ΄ μμ„ λ•λ” μ°Έμ΅° IDκ°€ ν•„μ”ν•©λ‹λ‹¤"
```

### **λ¬Έμ  μ›μΈ**
1. **λΉ„μ¦λ‹μ¤ λ΅μ§ μμ„ λ¬Έμ **
   - ν¬μΈνΈ μ°¨κ°μ„ μ£Όλ¬Έ μƒμ„± μ „μ— μ‹λ„
   - μ£Όλ¬Έμ΄ μƒμ„±λμ§€ μ•μ•λ”λ° ν¬μΈνΈλ¥Ό μ°¨κ°ν•λ ¤κ³  ν•¨

2. **Validation λ΅μ§ λ¬Έμ **
   - PointSpendRequestμ—μ„ referenceTypeμ΄ μμΌλ©΄ referenceIdλ„ ν•„μ”
   - ShopServiceImplμ—μ„ referenceTypeμ„ PURCHASEλ΅ μ„¤μ •ν•κ³  referenceIdλ¥Ό nullλ΅ μ„¤μ •

3. **νΈλμ­μ… κ΄€λ¦¬ λ¬Έμ **
   - ν¬μΈνΈ μ°¨κ° μ‹¤ν¨ μ‹ μ£Όλ¬Έλ„ λ΅¤λ°±λμ§€ μ•μ

## π― μ‘μ—… κ³„ν

### **1λ‹¨κ³„: ShopServiceImpl.processItemOrder() λ©”μ„λ“ μμ •**

**ν„μ¬ λ΅μ§ (λ¬Έμ ):**
```java
1. ν¬μΈνΈ μ°¨κ° μ‹λ„ (referenceId = null) β
2. μ‚¬μ©μ μ•„μ΄ν… μ¶”κ°€/μμ •
3. μ£Όλ¬Έ μƒμ„±
```

**μμ •λ λ΅μ§ (ν•΄κ²°):**
```java
1. μ£Όλ¬Έ μƒμ„± (μƒνƒ: PENDING)
2. ν¬μΈνΈ μ°¨κ° (referenceId = μ£Όλ¬ΈID)
3. μ‚¬μ©μ μ•„μ΄ν… μ¶”κ°€/μμ •
4. μ£Όλ¬Έ μƒνƒλ¥Ό COMPLETEDλ΅ λ³€κ²½
5. ν¬μΈνΈ μ°¨κ° μ‹¤ν¨ μ‹ μ£Όλ¬Έ μƒνƒλ¥Ό CANCELLEDλ΅ λ³€κ²½
```

### **2λ‹¨κ³„: νΈλμ­μ… κ΄€λ¦¬ κ°μ„ **
- `@Transactional` μ–΄λ…Έν…μ΄μ…μΌλ΅ μ „μ²΄ λ©”μ„λ“ νΈλμ­μ… κ΄€λ¦¬
- ν¬μΈνΈ μ°¨κ° μ‹¤ν¨ μ‹ μ£Όλ¬Έλ„ μλ™ λ΅¤λ°±
- λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥

### **3λ‹¨κ³„: μ—λ¬ μ²λ¦¬ κ°μ„ **
- κµ¬μ²΄μ μΈ μ—λ¬ λ©”μ‹μ§€ μ κ³µ
- μ‚¬μ©μμ—κ² λ…ν™•ν• ν”Όλ“λ°± μ κ³µ
- λ΅κΉ… κ°μ„ 

## π”§ μ‹¤μ  μ‘μ—… λ‚΄μ©

### **μμ •λ νμΌ**
- `backend/solsol/src/main/java/com/solsolhey/shop/service/ShopServiceImpl.java`

### **μ£Όμ” μμ • μ‚¬ν•­**

#### **1. processItemOrder() λ©”μ„λ“ λ΅μ§ μμ„ λ³€κ²½**
```java
// κΈ°μ΅΄: ν¬μΈνΈ μ°¨κ° β†’ μ‚¬μ©μ μ•„μ΄ν… μ²λ¦¬ β†’ μ£Όλ¬Έ μƒμ„±
// μμ •: μ£Όλ¬Έ μƒμ„± β†’ ν¬μΈνΈ μ°¨κ° β†’ μ‚¬μ©μ μ•„μ΄ν… μ²λ¦¬ β†’ μ£Όλ¬Έ μƒνƒ μ—…λ°μ΄νΈ
```

#### **2. referenceId μ¬λ°”λ¥΄κ² μ„¤μ •**
```java
// κΈ°μ΅΄
PointSpendRequest spendRequest = new PointSpendRequest(
    totalPrice, 
    "μƒν’ κµ¬λ§¤: " + item.getName(), 
    null, // μ£Όλ¬Έ IDλ” μ£Όλ¬Έ μƒμ„± ν›„ μ„¤μ •
    ReferenceType.PURCHASE
);

// μμ •
PointSpendRequest spendRequest = new PointSpendRequest(
    totalPrice, 
    "μƒν’ κµ¬λ§¤: " + item.getName(), 
    savedOrder.getId(), // μƒμ„±λ μ£Όλ¬Έ ID μ‚¬μ©
    ReferenceType.PURCHASE
);
```

#### **3. μ£Όλ¬Έ μƒνƒ κ΄€λ¦¬ κ°μ„ **
```java
// μ£Όλ¬Έμ„ PENDING μƒνƒλ΅ μƒμ„±
Order order = Order.builder()
    .userId(userId)
    .itemId(item.getId())
    .quantity(quantity)
    .totalPrice(totalPrice)
    .orderType(Order.OrderType.ITEM)
    .status(Order.OrderStatus.PENDING) // μ΄κΈ° μƒνƒ
    .build();

Order savedOrder = orderRepository.save(order);

// ν¬μΈνΈ μ°¨κ° μ„±κ³µ μ‹ μ£Όλ¬Έ μƒνƒλ¥Ό COMPLETEDλ΅ λ³€κ²½
savedOrder.setStatus(Order.OrderStatus.COMPLETED);
orderRepository.save(savedOrder);
```

## β… μ‘μ—… κ²°κ³Ό

### **μμ • μ™„λ£ μ‚¬ν•­**
1. β… ShopServiceImpl.processItemOrder() λ©”μ„λ“ λ΅μ§ μμ„ λ³€κ²½
2. β… referenceIdλ¥Ό μ¬λ°”λ¥΄κ² μ„¤μ •
3. β… μ£Όλ¬Έ μƒνƒ κ΄€λ¦¬ κ°μ„ 
4. β… νΈλμ­μ… κ΄€λ¦¬ κ°μ„ 

### **ν…μ¤νΈ κ²°κ³Ό**
- μ•„μ΄ν… κµ¬λ§¤ μ‹ 400 μ—λ¬ ν•΄κ²°
- ν¬μΈνΈ μ°¨κ°κ³Ό μ£Όλ¬Έ μƒμ„±μ΄ μ¬λ°”λ¥Έ μμ„λ΅ μ²λ¦¬
- λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥

### **ν–¥ν›„ κ°μ„  μ‚¬ν•­**
1. μ—λ¬ μ²λ¦¬ λ©”μ‹μ§€ κ°μ„ 
2. λ΅κΉ… λ λ²¨ μ΅°μ •
3. λ‹¨μ„ ν…μ¤νΈ μ¶”κ°€

## π“ κ²°λ΅ 

λ°±μ—”λ“μ μ£Όλ¬Έμ²λ¦¬ λ΅μ§μ„ μμ •ν•μ—¬ μ•„μ΄ν… κµ¬λ§¤ κΈ°λ¥μ΄ μ •μƒ μ‘λ™ν•κ² λμ—μµλ‹λ‹¤. 

**μ£Όμ” μ„±κ³Ό:**
- λΉ„μ¦λ‹μ¤ λ΅μ§ μμ„ κ°μ„ 
- λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄μ¥
- μ‚¬μ©μ κ²½ν— ν–¥μƒ

**ν•™μµ ν¬μΈνΈ:**
- λ°±μ—”λ“ λ΅μ§ μ„¤κ³„ μ‹ λΉ„μ¦λ‹μ¤ μμ„ κ³ λ ¤ ν•„μ”
- Validation λ΅μ§μ μΌκ΄€μ„± ν™•λ³΄ μ¤‘μ”
- νΈλμ­μ… κ΄€λ¦¬μ μ¤‘μ”μ„±
